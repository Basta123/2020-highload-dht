
Для нагрузочного тестирования сервера, а также измерения параметров была использована программа wrk, а также профайлер под названием async-profiler. 
Запросы были сделаны на локальный хост по адресу http://127.0.0.1:8080.

Выполним запрос, используя следующую команду: wrk -t1 -c1 -d10m -s wrk/put.lua -R2000 --latency http://127.0.0.1:8080. Для формирования запроса мы используем скрипт на языке Lua.
![](https://github.com/Basta123/2020-highload-dht/blob/master/profiling/CPUPut.svg)

![](https://github.com/Basta123/2020-highload-dht/blob/master/profiling/CPUPut.svg | width=100)

Running 10m test @ http://127.0.0.1:8080
  1 threads and 1 connections
  Thread calibration: mean lat.: 8.657ms, rate sampling interval: 11ms
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     2.89ms    3.55ms  68.03ms   92.50%
    Req/Sec     2.14k   640.02    12.90k    79.91%
  Latency Distribution (HdrHistogram - Recorded Latency)
 50.000%    2.02ms
 75.000%    3.26ms
 90.000%    5.54ms
 99.000%   18.70ms
 99.900%   39.26ms
 99.990%   58.85ms
 99.999%   66.05ms
100.000%   68.10ms

  Detailed Percentile spectrum:
       Value   Percentile   TotalCount 1/(1-Percentile)

       0.045     0.000000            1         1.00
       0.606     0.100000       118266         1.11
       1.008     0.200000       236064         1.25
       1.345     0.300000       354223         1.43
       1.668     0.400000       472043         1.67
       2.017     0.500000       590196         2.00
       2.211     0.550000       649336         2.22
       2.421     0.600000       708016         2.50
       2.657     0.650000       767247         2.86
       2.921     0.700000       826082         3.33
       3.255     0.750000       885307         4.00
       3.463     0.775000       914595         4.44
       3.715     0.800000       944021         5.00
       4.029     0.825000       973572         5.71
       4.419     0.850000      1003019         6.67
       4.907     0.875000      1032618         8.00
       5.203     0.887500      1047411         8.89
       5.543     0.900000      1062017        10.00
       5.947     0.912500      1076777        11.43
       6.439     0.925000      1091511        13.33
       7.059     0.937500      1106304        16.00
       7.443     0.943750      1113656        17.78
       7.907     0.950000      1121018        20.00
       8.487     0.956250      1128392        22.86
       9.223     0.962500      1135771        26.67
      10.215     0.968750      1143149        32.00
      10.831     0.971875      1146808        35.56
      11.575     0.975000      1150515        40.00
      12.471     0.978125      1154188        45.71
      13.639     0.981250      1157879        53.33
      15.079     0.984375      1161563        64.00
      15.927     0.985938      1163412        71.11
      16.879     0.987500      1165258        80.00
      17.951     0.989062      1167098        91.43
      19.231     0.990625      1168931       106.67
      20.767     0.992188      1170780       128.00
      21.615     0.992969      1171698       142.22
      22.607     0.993750      1172622       160.00
      23.759     0.994531      1173545       182.86
      25.087     0.995313      1174472       213.33
      26.767     0.996094      1175385       256.00
      27.759     0.996484      1175848       284.44
      28.863     0.996875      1176307       320.00
      30.207     0.997266      1176771       365.71
      31.695     0.997656      1177231       426.67
      33.471     0.998047      1177695       512.00
      34.399     0.998242      1177922       568.89
      35.423     0.998437      1178150       640.00
      36.671     0.998633      1178383       731.43
      37.951     0.998828      1178610       853.33
      39.487     0.999023      1178842      1024.00
      40.383     0.999121      1178959      1137.78
      41.247     0.999219      1179072      1280.00
      42.271     0.999316      1179186      1462.86
      43.615     0.999414      1179304      1706.67
      45.247     0.999512      1179417      2048.00
      46.175     0.999561      1179474      2275.56
      47.199     0.999609      1179532      2560.00
      48.351     0.999658      1179590      2925.71
      49.759     0.999707      1179647      3413.33
      51.359     0.999756      1179706      4096.00
      52.319     0.999780      1179733      4551.11
      53.503     0.999805      1179762      5120.00
      54.559     0.999829      1179791      5851.43
      55.999     0.999854      1179820      6826.67
      57.503     0.999878      1179848      8192.00
      58.271     0.999890      1179863      9102.22
      59.007     0.999902      1179877     10240.00
      59.679     0.999915      1179892     11702.86
      60.447     0.999927      1179907     13653.33
      61.247     0.999939      1179920     16384.00
      61.759     0.999945      1179928     18204.44
      62.303     0.999951      1179935     20480.00
      62.847     0.999957      1179942     23405.71
      63.391     0.999963      1179949     27306.67
      63.967     0.999969      1179956     32768.00
      64.351     0.999973      1179960     36408.89
      64.703     0.999976      1179964     40960.00
      64.959     0.999979      1179967     46811.43
      65.215     0.999982      1179971     54613.33
      65.471     0.999985      1179974     65536.00
      65.663     0.999986      1179976     72817.78
      65.855     0.999988      1179978     81920.00
      66.047     0.999989      1179980     93622.86
      66.367     0.999991      1179983    109226.67
      66.367     0.999992      1179983    131072.00
      66.623     0.999993      1179984    145635.56
      66.687     0.999994      1179985    163840.00
      66.815     0.999995      1179986    187245.71
      66.943     0.999995      1179987    218453.33
      67.199     0.999996      1179988    262144.00
      67.199     0.999997      1179988    291271.11
      67.455     0.999997      1179989    327680.00
      67.455     0.999997      1179989    374491.43
      67.711     0.999998      1179990    436906.67
      67.711     0.999998      1179990    524288.00
      67.711     0.999998      1179990    582542.22
      67.903     0.999998      1179991    655360.00
      67.903     0.999999      1179991    748982.86
      67.903     0.999999      1179991    873813.33
      67.903     0.999999      1179991   1048576.00
      67.903     0.999999      1179991   1165084.44
      68.095     0.999999      1179992   1310720.00
      68.095     1.000000      1179992          inf
#[Mean    =        2.888, StdDeviation   =        3.550]
#[Max     =       68.032, Total count    =      1179992]
#[Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
  1199997 requests in 10.00m, 106.43MB read
Requests/sec:   1999.99
Transfer/sec:    181.64KB





Latency Distribution (HdrHistogram - Recorded Latency)
 50.000%    2.02ms
 75.000%    3.26ms
 90.000%    5.54ms
 99.000%   18.70ms
 99.900%   39.26ms
 99.990%   58.85ms
 99.999%   66.05ms
100.000%   68.10ms

Как видно 1% запросов занимает существенно больше времени, чем все остальные запросы, что может быть связано с записью данных из памяти на жесткий диск после пересечения порога.

https://github.com/Basta123/2020-highload-dht/blob/master/profiling/CPUPut.svg


wrk -t1 -c1 -d3m -s wrk/get.lua -R2000 —latency http://127.0.0.1:8080
wrk -t1 -c1 -d3m -s wrk/get.lua -R2000 —latency http://127.0.0.1:8080
